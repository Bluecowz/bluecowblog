+++
title = "Twitch User Authentication"
date = "2021-11-30"
author = "Mike"
cover = "hello.jpg"
description = "Using React to let users login with Twitch."
draft=false
+++

## User Login via Twitch using React

I was recently working on a project where I wanted to let users login via [Twitch](https://twitch.tv). Originally, I was building the project in Django but found the framework too monolithic and it annoyed me. So I decided to move the project to React. After moving the project I spent at least two hours trying to rebuild the login process. I had done it once before and I screwed it up the second time. I'm going to write it down so when I forget again I'll be able to check. 


### Register Your Application With Twitch

In order to login with Twitch we need to register our application and get a client ID and client secret. Head over to the [developer console](https://dev.twitch.tv/console) and navigate to the Applications section. Click the *Register Your Application* button. 


#### Name
~~For this example I'm going to name my application *Example*.~~ I could not call my project Example because apparently these names are not just a random name for your project. Damn. Guess its *ExampleLoginProject*.


#### OAuth Redirect URLs
For developement, I'm going to make my OAuth Redirect URL: **http://localhost:3000/twitchauth/**. This link is important, later when we come to Twitch asking to log a user in for us, Twitch will need to know where to send them back to with our authentication code. 

#### Catagory
I'm going to select my catagory as *other* because I'm not actually doing anything with this application but you should select the catagory that best works for you.


#### Not A Robot
Once you are determined to not be a 011100100110111101100010011011110111010000001010 hit the create button and now you have a project. Hit 'manage' to go into your project. 

This is where you will find the **Client ID** and **Client Secret**. You will need to generate a new secret. Be sure to put it somewhere because you cannot be shown the secret again. Instead, it generates a new one and the existing secret is obsolete. This can be a pain when working across multiple computers.

**Please do not commit your client secret to Github or whatever. Bad idea. Big no no. I don't even commit my Client ID.**

### Handling A Twitch Login

Now, we need to create a login link that users can click to login with Twitch. Will need to direct the user to id.twitch.tv. We will need our Twitch Client ID and our redirect URL. Your link you look something like this:

~~~

https://id.twitch.tv/oauth2/authorize
    ?client_id=your_client_id
    &redirect_uri=your_redirect_uri
    &response__type=code
    &scope=whatever_scope_you_want
    &state=some_state

~~~

We are setting the response type to *code* because we are asking for an authorization code to be returned. We will use this later to exchange for a authorization token. We must also set a scope and you can find a full list of scopes [here](https://dev.twitch.tv/docs/authentication/#scopes). The *scope* is not required for this call but is **strongly encouraged** as it is used to avoid CSRF. This should be a unique token generated by your application and is sent back to you by Twitches servers. 

Now, we need to setup a route to handle the redirect from Twitch. Here is a minimalist example of using react-router-dom.

~~~

function App() {
 return (
  <Router>
   <Routes>
    <Route path="/" element={<Home/>} />
    <Route path="/twitchAuth" element={<TwitchAuth/>} />
   </Routes>
  </Router>
 );
}


~~~

The route for your Twitch Authorization handler can be whatever you want but I like twitchAuth. It should point to a react componenet that we will use to handle the code given to use from Twitch. 

### Now Let's Handle That Code

So far, the user clicks a link which bounces them over to Twitch where they can login and tell Twitch they approve of our scopes. When the user approves/logs in Twitch will redirect them to the redirect link we gave to Twitch. This will bouce the user to our Twitch Auth URL were we can setup a React componenet to handle the second stage of login. Now that we have a code we will combine this with our client secret to azquire an Authroization Token. This token will allow us to make calls to the Twitch API as the user. We are going to use [Axios](https://axios-http.com/) to make API calls. 

```
npm install axios
```

First, we need to extract the code given to use from Twitch in the URL. We can use the useLocation hook in react-router-dom. 

~~~

let twitchCode = new URLSearchParams(useLocation().search).get("code");

~~~

With this code we will make a call to Twitch to aquire a Authorization Token. Lets make a function to create a URL to get our Auth Token.

~~~

const tokenUrl = () => {
 let url: string = 'https://id.twitch.tv/oauth2/token';
 url += '?client_id=' + clientId;
 url += '&client_secret=' + clientSecret;
 url += '&code=' + code;
 url += '&grant_type=authorization_code';
 url += '&redirect_url=<your redirect URL>';
 return url;
};


~~~

The redirect URL in this call should match the redirect URL provided in your Twitch Developer Console. Next, lets build our Axios config object and make our API call to Twitch.

~~~

let axiosConfig: AxiosRequestConfig = {
 method: 'post',
 url: tokenUrl,
 }

axios(axiosConfig)
.then((response: AxiosResponse) => {
 let token = response.data["access_token"];
 console.log(token);
});

 ~~~

With this token you can make [all kinds](https://dev.twitch.tv/docs/api/reference) of API calls to Twitch. It's really cool stuff.

Good luck!
